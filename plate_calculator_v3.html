<!doctype html>
<html lang="da"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>plate calculator v3</title>
<style>
body{font-family:system-ui;margin:20px;max-width:900px}
.row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
input,select,button{padding:8px;border-radius:6px;border:1px solid #ccc}
button{background:#111;color:#fff;border:none}
.secondary{background:#666}
.solution{border:1px solid #ddd;padding:10px;border-radius:8px;margin-top:10px}
.nearest{border-color:#f0a500;background:#fff6d5}
.small{font-size:13px;color:#666}
</style></head><body>
<h1>plate calculator v3</h1>
<div class="row">
<label>stang <select id="barSel"></select></label>
<label>mål (kg pr stang / pr håndvægt)<input id="target" type="number" step="0.5"></label>
<button id="addBar" class="secondary">tilføj stang</button>
</div>
<h2>plader</h2><div id="plates"></div><button id="addPlate" class="secondary">tilføj plade</button>
<div style="margin-top:10px"><button id="calc">beregn</button></div>
<div id="result"></div>
<script>
const STORE="pc_v3";let S=JSON.parse(localStorage.getItem(STORE)||"{}");
if(!S.plates)S.plates=[{w:20,c:2},{w:10,c:2},{w:5,c:2},{w:2.5,c:2},{w:1,c:2},{w:0.5,c:2}];
if(!S.bars)S.bars=[{name:"barbell",w:10,type:"barbell"},{name:"dumbbells",w:1.5,type:"dumbbell"}];
if(!S.last)S.last=S.bars[0].name;
const save=()=>localStorage.setItem(STORE,JSON.stringify(S));
const barSel=document.getElementById("barSel");
function renderBars(){barSel.innerHTML="";S.bars.forEach(b=>{let o=document.createElement("option");o.value=b.name;o.textContent=b.name+" ("+b.w+"kg "+b.type+")";barSel.appendChild(o);});barSel.value=S.last;}
barSel.onchange=()=>{S.last=barSel.value;save();};
document.getElementById("addBar").onclick=()=>{let n=prompt("navn");if(!n)return;let w=parseFloat(prompt("vægt kg"));if(!w)return;let t=prompt("type? barbell/dumbbell","barbell");S.bars.push({name:n,w,type:t});save();renderBars();};
const platesDiv=document.getElementById("plates");
function renderPlates(){platesDiv.innerHTML="";S.plates.forEach((p,i)=>{let d=document.createElement("div");d.className="row";
d.innerHTML=`<input type=number step=0.5 value=${p.w}><input type=number value=${p.c}><button class=secondary>x</button>`;
d.children[0].oninput=e=>{p.w=parseFloat(e.target.value)||0;save();};
d.children[1].oninput=e=>{p.c=parseInt(e.target.value)||0;save();};
d.children[2].onclick=()=>{S.plates.splice(i,1);save();renderPlates();};
platesDiv.appendChild(d);});}
document.getElementById("addPlate").onclick=()=>{S.plates.push({w:1,c:0});save();renderPlates();};
function solveExact(target,plates){const res=[];
function dfs(i,sum,cur){if(sum===target){res.push({...cur});return;}
if(i===plates.length||sum>target)return;let p=plates[i];
for(let k=Math.floor(p.c/2);k>=0;k--){let ns=sum+k*p.w;if(ns>target)continue;cur[p.w]=k;dfs(i+1,ns,cur);}delete cur[p.w];}
dfs(0,0,{});return res;}
document.getElementById("calc").onclick=()=>{
const target=parseFloat(document.getElementById("target").value);const bar=S.bars.find(b=>b.name===barSel.value);
if(!bar||!target){alert("indtast mål");return;}
let plates=S.plates.filter(p=>p.c>=2).sort((a,b)=>b.w-a.w);let need=target-bar.w;
let per = bar.type==="barbell"? need/2 : need;
let exact=solveExact(per,plates);let R=document.getElementById("result");R.innerHTML="";
if(exact.length){exact.forEach(sol=>{let d=document.createElement("div");d.className="solution";
d.innerHTML="<b>præcis</b><br>"+Object.entries(sol).map(([w,c])=>c+"×"+w+"kg").join(", ");R.appendChild(d);});}
else{R.innerHTML="<div>ingen præcis løsning</div>";let best=null,bd=999;
for(let dlt=-1;dlt<=1;dlt+=0.5){let t=per+dlt;if(t<=0)continue;let s=solveExact(t,plates);
if(s.length&&Math.abs(dlt)<bd){bd=Math.abs(dlt);best={sol:s[0],d:dlt};}}
if(best){let d=document.createElement("div");d.className="solution nearest";
d.innerHTML="<b>nærmeste</b><br>"+Object.entries(best.sol).map(([w,c])=>c+"×"+w+"kg").join(", ")
+`<div class=small>afvigelse ${best.d>0?"+":""}${best.d} kg pr side</div>`;R.appendChild(d);}}};
renderBars();renderPlates();
</script></body></html>